#!/usr/bin/ruby

# Generalization of A309566 to other bases.
# https://oeis.org/A309566
# 307, 130307, 309370307, 30281172370306703

func isok(n, b=10) {

    n.is_prime || return false

    var parts = n.digits(b).split_by { _ == 0 }
    parts.all { .digits2num(b).is_prime } || return false

    for i in (0 .. parts.end) {
        for j in (i+1 .. parts.end) {
            parts.slice(i,j).join_insert([0]).flat.digits2num(b).is_prime || return false
        }
    }

    return true
}

assert([307, 130307, 309370307, 30281172370306703].all{ isok(_, 10) })

func a(n, b, from = (2 * b**2)) is cached {
    from..Inf -> first {|k|
        k.is_prime && (k.digits(b).count(0) == n) && isok(k, b)
    }
}

# Generate A309566-like sequences in base b.
#~ for b in (2..10) {
    #~ say [b, 2.of { a(_+1, b) }]
#~ }

# Smallest prime of the form "a0b" in base 10^k
#~ for k in (1..30) {
    #~ say a(1, 10**k)
#~ }

# Smallest prime of the form "a0b" in base b
for b in (2..100) {
    say [b,a(1, b)]
}

__END__

# The first two terms of A309566-like sequences for base n.

[2, [59, 1787]]
[3, [47, 44939]]
[4, [83, 12619]]
[5, [53, ???]
[6, [113, 15809]]
[7, [101, 4951]]
[8, [131, 8389]]
[9, [167, 121421]]
[10, [307, 130307]]
[11, [607, ???]]
[12, [293, 104693]]

# Primes of the form "a0b0c", where "a", "b" and "c" are all primes in base 2.

1787
4027
1048507
16776187
4722366482869645212667

# a(n) is the smallest prime of the form "a0b", where a and b are two zeroless primes in base n.
# Lower bound: a(n) > 2 * n^2

[2, 59]
[3, 47]
[4, 83]
[5, 53]
[6, 113]
[7, 101]
[8, 131]
[9, 167]
[10, 307]
[11, 607]
[12, 293]
[13, 349]
[14, 397]
[15, 457]
[16, 523]
[17, 1447]
[18, 653]
[19, 727]
[20, 811]
[21, 887]
[22, 971]
[23, 1061]
[24, 1163]
[25, 1877]
[26, 2039]
[27, 1471]
[28, 1571]
[29, 1693]
[30, 1811]
[31, 1933]
[32, 2053]
[33, 2207]
[34, 2341]
[35, 2467]
[36, 2609]
[37, 2741]
[38, 2917]
[39, 3049]
[40, 3203]
[41, 3373]
[42, 3533]
[43, 3701]
[44, 3877]
[45, 4057]
[46, 4243]
[47, 4421]
[48, 4621]
[49, 4813]
[50, 5003]
[51, 5209]
[52, 5413]
[53, 5623]
[54, 5839]
[55, 6053]
[56, 6277]
[57, 6521]
[58, 6733]
[59, 6967]
[60, 7207]
[61, 7459]
[62, 7691]
[63, 7949]
[64, 8209]
[65, 8461]
[66, 8719]
[67, 9001]
[68, 9277]
[69, 9533]
[70, 9803]
[71, 10093]
[72, 10391]
[73, 10663]
[74, 10957]
[75, 11257]
[76, 11593]
[77, 11863]
[78, 12197]
[79, 12487]
[80, 12823]
[81, 13127]
[82, 13451]
[83, 13781]
[84, 14143]
[85, 14461]
[86, 14797]
[87, 15149]
[88, 15493]
[89, 15859]
[90, 16217]
[91, 16567]
[92, 16931]
[93, 17317]
[94, 17683]
[95, 18061]
[96, 18439]
[97, 18859]
[98, 19211]
[99, 19609]
[100, 20011]

# a(n) is the smallest prime of the form "a0b", where "a" and "b" are both primes in base 10^n.

307
20011
2000003
200000083
20000000089
2000000000003
200000000000029
20000000000000003
2000000000000000137
200000000000000000089
20000000000000000000003
2000000000000000000000003
200000000000000000000000107
20000000000000000000000000131
2000000000000000000000000000071
200000000000000000000000000000173
20000000000000000000000000000000347
2000000000000000000000000000000000041
200000000000000000000000000000000000023
20000000000000000000000000000000000000593
2000000000000000000000000000000000000000179
200000000000000000000000000000000000000000701
20000000000000000000000000000000000000000000479
2000000000000000000000000000000000000000000000179
200000000000000000000000000000000000000000000000347
20000000000000000000000000000000000000000000000000029
2000000000000000000000000000000000000000000000000000059
200000000000000000000000000000000000000000000000000000293
20000000000000000000000000000000000000000000000000000000023
2000000000000000000000000000000000000000000000000000000000419
