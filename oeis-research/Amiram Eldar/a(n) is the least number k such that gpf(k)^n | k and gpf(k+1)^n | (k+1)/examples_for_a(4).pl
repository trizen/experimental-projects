#!/usr/bin/perl

# a(n) is the least number k such that P(k)^n | k and P(k+1)^n | (k+1), where P(k) = A006530(k) is the largest prime dividing k, or -1 if no such k exists.
# https://oeis.org/A354567

# Known terms:
#   1, 8, 6859, 11859210

# Known upper-bounds:
#   a(5) <= 437489361912143559513287483711091603378 (De Koninck, 2009).

# Lower-bounds:
#  a(5) > 10^18
#  a(6) > 10^19

# Beside 11859210, no other term k < 10^18 exists that satisfy:
#   gpf(k)^4 | k and gpf(k+1)^4 | (k+1)

# One term that satisfies gpf(k)^5 | k and gpf(k+1)^4 | (k+1):
#   33604891766609212616768123

use 5.020;
use strict;
use warnings;

use ntheory qw(primes);
use Math::Prime::Util::GMP qw(chinese is_smooth powint mulint addint);

my $n = 4;

#my $plimit = 20000;
#my $klimit = 20;

my $plimit = 6619;
my $klimit = 100;

my @primes = @{primes(11, $plimit)};

#my @primes = (4957, 6619);

#~ $plimit *= 4;
#~ my @primes = @{primes($plimit>>1, $plimit)};

#~ $klimit = 0;
#~ $plimit = 1e5;
#~ @primes = @{primes(1e4,$plimit)};

say ":: Searching for a($n) with max(p) = $plimit";
printf(":: Cost: ~10^%.3f\n", log(scalar(@primes)**2 * ($klimit + 1)) / log(10));

foreach my $p (@primes) {
    my $pn = powint($p, $n);
    foreach my $q (@primes) {

        next if ($p == $q);

        my $qn = powint($q, $n);
        my $c  = chinese([0, $pn], [-1, $qn]);
        my $m  = mulint($pn, $qn);

        foreach my $k (0 .. $klimit) {
            my $t = addint(mulint($m, $k), $c);

            if ($n == 5) {
                $t > 1e18 or next;
            }
            elsif ($n == 6) {
                $t > 1e19 or next;
            }

            if (is_smooth($t, $p) and is_smooth(addint($t, 1), $q)) {
                say "[$k] Found: a($n) <= $t";
            }
        }
    }
}

__END__

# Terms > 10^18 (with possible gaps) that satify gpf(k)^4 | k and gpf(k+1)^4 | (k+1):

632127050601113666430
1337735048956150266042387
2680039696336465776297024
4974823008148736705412779
31974788233410814755001226
33604891766609212616768123
34120594939631428731879552
38608555856573926530371168
51311193560015530309040120
98037545990205809310138983
126800279858565208059914897
169637008310453823025888754
269567690573192359921445949
558888319993468395808349735
686502639307635437319470514
778506222294353477447984951
842567665972923891965922240
1170473648585166502779704448
1604523760760133661865226485
1677617440384730529239109970
2339961332716559992867410841
4040949126821098781428807884
4334390026823625979576612784
5176082045210113889495061574
7530003151363751379678423968
8893607114611051823782705689
10343369918570520888351704335
10483299618047710305647246747
10962415992964740291362264361
13315128424315140158173670105
15607079861704755555970398976
18004642995648502906207324400
20340342405206476107717123224
21827805200445357028865620593
25989962017631224107949787462
35991156578342937778118314023
39792808379035601346861276375
40338213188235504817828169707
48091485082026743064811487984
60498241074060845775551550629
69949518433419144325368317992
88665537519555649075295799225
103842378099754972413715199214
105970459415819060663971847664
154242890116784265656988526170
158232368566344640404056092026
163305399368245669780325968689
172494806464459674425927525350
173416977067642263013131591974
175748184719990986021464829984
176953240020610785641846710655
184517635400201157119251097274
199932787274992486363545158366
343632753646069639255887320399
398357568898820545350922992405
407664243998475240835795205755
413856930009625402893726406030
464018943820154847784547266203
497646563795858820414569943665
612479799876805719002297705190
900612574183190012941627106913
915827124420130246060484892767
935019595374226249705564933610
953624493877133776534407401050
1074527477780540369144793583855
1081117737282146848776234843450
1151587687539831881352744778124
1272445501705979843943161195955
1341264362490229478909369076380
1499965509691681559213935842902
1529146697768775959994120708674
1664714095520603511870845524929
1781137197253259706743354232915
2027309509228506548939316679943
2124708366036638221834493844145
2148753732529136306554701550665
2209122040482592584551959448450
2233858596416177377902786275689
2410465173473908033552745941212
2613599084484623451058435091568
2820141578730019342585889613079
3748987092840569063864657177779
4309564161637068322473009613424
6289939810675044954334081733344
6890821155439412751128098237861
7881138759558443840845192042325
7886909131814123514804222615551
7995203786571920381761952838216
8376538725073334455723998355799
9545174710279455045861615548275
12832589880603272128289655517439
14103743494196313646907604800729
16256271473510046356641580432224
22853557677514342299793510844250
29715747703042212596964003744458
31478231667522768422427652775563
36410430357999408154662344557055
97299962872696638912433489545383
