#!/usr/bin/perl

# Abundant numbers that differ from the next abundant number by 5.
# https://oeis.org/A306497

# Generate the generalized Hamming numbers bellow a certain limit, given a set of primes.

use 5.020;
use warnings;
use Math::GMPz;
use experimental qw(signatures);
use ntheory qw(divisors vecsum primes divisor_sum valuation);

sub check_valuation($n, $p) {

    #~ if ($p == 2) {
        #~ return (valuation($n, 2) < 15);
    #~ }

    #~ if ($p == 3) {
        #~ return ($n % ($p*$p*$p*$p*$p*$p) != 0);
    #~ }

    if ($p == 5) {
        return ($n % ($p*$p*$p*$p) != 0);
    }

    if ($p == 7) {
        return ($n % ($p*$p*$p*$p) != 0);
    }

    ($n % ($p*$p*$p)) != 0;
}

sub hamming_numbers ($limit, $primes) {

    my @h = (1);
    foreach my $p (@$primes) {

        say "Prime: $p";
        foreach my $n (@h) {
            if ($n * $p <= $limit and check_valuation($n, $p)) {
                push @h, $n * $p;
            }
        }
    }

    return \@h;
}

# 5391411025, 28816162375, 34393484125, 37739877175, 53356378075
# 5391411025, 28816162375, 34393484125, 37739877175, 53356378075, 61164628525, 63395557225, 64899009175, 67275433225, 70088343325, 75665665075, 76781129425, 97974952075

# 5391411025, 28816162375, 34393484125, 37739877175, 53356378075, 61164628525, 63395557225, 64899009175, 67275433225, 70088343325, 75665665075, 76781129425, 97974952075

# 5391411025, 28816162375, 34393484125, 37739877175, 53356378075, 61164628525, 63395557225, 64899009175, 67275433225, 70088343325, 75665665075, 76781129425, 97974952075, 102436809475, 132554346925, 167133741775, 199482207925, 201713136625, 231830674075, 236292531475, 240754388875, 254333954875, 264179140225, 270871926325, 279795641125, 282026569825, 296527606375, 297934061425, 298535442205, 303559881625, 305451321175, 309466992835, 323298750775, 325470970825, 327760608175, 328876072525, 340030716025, 341534167975, 346946594995, 352785808375, 354754845445, 355598718475, 359575591375, 361224538675, 364570931725, 367694231905, 373494646525, 374610110875, 375725575225, 376414253215, 378250047175, 385134274525, 393573004825, 396919397875, 398665342075, 400042698055, 403087259575, 405843112675, 409189505725, 412196409625, 413263375525, 414097548865, 419228684875, 423690542275, 425921470975, 428152399675, 428734381075, 431029123525, 435960650125, 438860857435, 443768900575, 445330550665, 447115293625, 454293064225, 458269937125, 459676392175, 464962723225, 470928032575, 471655509325, 472334487625, 473740942675, 475001902375, 478348295425, 480579224125, 482810152825, 482858651275, 488387474575, 490618403275, 492180053365, 510696761575, 511715229025, 512927690275, 514043154625, 515934594175, 519620476375, 522966869425, 527962209775, 529659655525, 533006048575, 534218509825, 535906255885, 537467905975, 539844330025, 541929763375, 547507085125, 556430799925, 559534700725, 567585443425, 568254722035, 570931836475, 585432873025, 601049373925, 602164838275, 603134807275, 612204017425, 615550410475, 620012267875, 631166911375, 637859697475, 646734913825, 646783412275, 647898876625, 653476198375, 660168984475, 663515377525, 667831739575, 669092699275, 690286521925, 693632914975, 717057666325, 739366953325, 757017536275, 768815212165, 776128778425, 781754598625, 791066301025, 795140170825, 800482657975, 824142243925, 843687119275, 864735446575, 873222675325, 874580631925, 893301033625, 896647426675, 906832101175, 927880428475, 944175907675, 951305179825, 955414785325, 959113430275, 969375702295, 980501246725, 983653645975, 998154682525

sub isok ($n) {

    divisor_sum($n) > 2*$n or return;
    divisor_sum($n+5) > 2*($n+5) or return;

    foreach my $k(1..4) {
        if (divisor_sum($n+$k) > 2*($n+$k)) {
            return;
        }
    }

    return 1;
}

my $h = hamming_numbers(10**11, primes(97));

say "Found: ", scalar(@$h), " terms";

local $| = 1;
foreach my $n(@$h) {

    if (isok($n)) {
        print "$n, ";
    }

    #foreach my $k(0..30) {
    #    my $t = ($n * 2**$k);
     #   if (isok($t)) {
      #      say $t;
     #   }
    #}
}
say '';



__END__


5391411025, 37739877175, 70088343325, 28816162375, 63395557225, 97974952075, 34393484125, 75665665075, 64899009175, 53356378075, 67275433225, 61164628525, 76781129425

foreach my $n(1..1e7) {
    if (isok($n)) {
        say $n;
    }
}

# Example: 5-smooth numbers bellow 100
#my $h = hamming_numbers(100, [2, 3, 5]);
#say join(', ', sort { $a <=> $b } @$h);
