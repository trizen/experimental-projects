#!/usr/bin/ruby

func isok_a(n, k) {

    var p = prime(n)

    (powmod(p, (k-1)/2, k) == 1)  && primes(p-1).all {|q|
        powmod(q, (k-1)/2, k) == k-1
    }
}

say isok_a(6, 35141256146761030267)
say isok_a(7, 4951782572086917319747)


func isok_b(n, k) {

    var p = prime(n)

    (powmod(p, (k-1)/2, k) == k-1)  && (1 ..^ p -> all {|q|
        powmod(q, (k-1)/2, k) == 1
    })
}

say isok_b(9, 12155831039329417441)
say isok_b(9, 33420814186701090241)
say isok_b(10, 41154189126635405260441)


__END__
#say isok(5, 32398013051587)
[

#32398013051587, 4627853036319787, 7333470436409443, 29645348137369147, 36140749487965627, 44213562255703843, 62804051517546907, 92101327510561027, 94423328872035643, 118469127753064747
#493813961816587, 655462669313563, 712305136356547, 1012925163368467, 1063809017035267, 1350727530916147, 1406616417615667, 1554737931642307, 1794376822387267, 2167215816099907, 2402921698865827
75350936251, 142186219181, 183413388211, 187403492251, 244970876021, 247945488451, 405439595861, 1121610731251, 1566655993781, 1990853572901, 2731649128781, 5042919827861, 5792018372251, 5830202612851, 6226129086451, 6664768278451, 7738029492211, 8648900162251, 9425030475451, 9429387401741, 10216085978251, 14804189283451, 15263877377251, 15883263707851

].map{
    isok(3, _)
}.say

__END__

b(n) is the smallest odd composite k such that prime(n)^((k-1)/2) == 1 (mod k) and q^((k-1)/2) == -1 (mod k) for every prime q < prime(n).

b(n) : 341, 29341, ?  Is this sequence finite?

Several upper-bounds for b(3)-b(5):
    b(3) <= 75350936251
    b(4) <= 493813961816587
    b(5) <= 32398013051587

An upper-bound for b(6) is currently not known.

Several more upper-bounds (examples), with possible gaps, for each b(3)-b(5):
    b(3) <= { 75350936251, 142186219181, 183413388211, 187403492251, 244970876021, 247945488451, 405439595861, 1121610731251, 1566655993781, 1990853572901, 2731649128781, 5042919827861, 5792018372251, 5830202612851, 6226129086451, 6664768278451, 7738029492211, 8648900162251, 9425030475451, 9429387401741, 10216085978251, 14804189283451, 15263877377251, 15883263707851, ... }
    b(4) <= { 493813961816587, 655462669313563, 712305136356547, 1012925163368467, 1063809017035267, 1350727530916147, 1406616417615667, 1554737931642307, 1794376822387267, 2167215816099907, 2402921698865827, ... }
    b(5) <= { 32398013051587, 4627853036319787, 7333470436409443, 29645348137369147, 36140749487965627, 44213562255703843, 62804051517546907, 92101327510561027, 94423328872035643, 118469127753064747, ... }
