#!/usr/bin/perl

# Carmichael numbers k that have an abundancy index sigma(k)/k that is larger than the abundancy index of all smaller Carmichael numbers.
# https://oeis.org/A329460

# Known terms:
#   561, 62745, 576480525985, 1886616373665, 3193231538989185, 11947816523586945, 101817952350880305, 171800042106877185

# Carmichael numbers divisible by 3*5*17*23:
#
#   1886616373665
#   3193231538989185
#   6128613921672705
#   11947816523586945
#   31454143858820145
#   101817952350880305
#   171800042106877185
#   180950795673242145
#   220629545178715905
#   781506906921758865
#   916541202603455265
#   947087538769733505
#   1177908521713261185
#   4448649946743866865
#   5473367446820370945
#   7626934787034827265

# Carmichael numbers divisible by 3*5*17*23*29:
#
#   171800042106877185
#   1177908521713261185

use 5.020;
use strict;
use warnings;

use ntheory qw(:all);
use Math::Prime::Util::GMP;

use Math::GMPz;
use Math::GMPq;
use Math::MPFR;

my %seen;
my $max = 0;

while (<>) {
    next if /^\h*#/;
    /\S/ or next;
    my $n = (split(' ', $_))[-1];

    $n || next;

    next if $n < ~0;

    #next if length($n) > 65;

    $n = Math::GMPz->new($n);
    $n % (3 * 5 * 17 * 23 * 29) == 0 or $n % (5 * 7 * 13 * 17 * 19 * 23) == 0 or next;

    Math::Prime::Util::GMP::is_carmichael($n) || next;

    #say "Testing: $n";

    my $t     = Math::GMPq->new(0);
    my $sigma = divisor_sum($n);
    Math::GMPq::Rmpq_set_str($t, "$sigma", 10);
    Math::GMPq::Rmpq_div_z($t, $t, $n);

    if ($t > $max) {

        #if ($t > 1.9) {
        #if ($t > 2) {
        printf "%.4f abundancy: $n\n", Math::MPFR->new($t) if !$seen{$n}++;

        #say $n;
        $max = $t;
    }
}

__END__
1.5401 record: 561
1.6524 record: 62745
1.6658 record: 576480525985
1.7943 record: 1886616373665
1.7949 record: 3193231538989185
1.8154 record: 11947816523586945
1.8166 record: 101817952350880305
1.8937 record: 171800042106877185

# Carmichael numbers > 2^64 where "records" for sigma(n)/n occur (upper-bounds):

1.8757 abundancy: 537329970884826078063105
1.8937 abundancy: 5981802520294676451270038145
1.9103 abundancy: 141934960805533535384100259905
1.9103 abundancy: 2609668563371076823446624111609234945
1.9178 abundancy: 1660636522047150213680847648152705371905
1.9185 abundancy: 404903458847157301705283775749441872254304065
1.9192 abundancy: 78608978003846049041116965738897583982829325185
1.9350 abundancy: 1495802867015723237589839615092213310803537834305
1.9350 abundancy: 74649323981476700646735560483727039302457914252915024385
1.9374 abundancy: 12234418303749373766457825700620527121617068058319432387585
1.9483 abundancy: 165502573617193579886078524884554371013787876466850820614145
1.9498 abundancy: 14701083488299057530174696885922722686956286485260401577115414785
1.9540 abundancy: 321030150905393790929751720043602006651739765349595158023943724894346115208705
1.9540 abundancy: 2219369513930461038686397245711097315022440029049430530493434841610470231287061362182145
1.9540 abundancy: 61372441497323670446623766914847705250104121305600853994877052461628649603145962092155011665219585
1.9603 abundancy: 41604760897693331902470165821292362461433951708063322154567188228941668682983586385358489704603458398732060344251877309069575573157372480292819346023961831997147106037750301707265

# Carmichael numbers > 2^64 where "records" for sigma(n)/n occur (upper-bounds) (newer results):

1.7891 abundancy: 20334436570711764865
1.8247 abundancy: 269613358123940932465
1.8247 abundancy: 84968960823844655779585
1.8696 abundancy: 3632039284174391831361985
1.9103 abundancy: 141934960805533535384100259905
1.9187 abundancy: 548163858624280095034801871883076465
1.9192 abundancy: 78608978003846049041116965738897583982829325185
1.9555 abundancy: 265343117395534782595001164438449865869221673985
1.9580 abundancy: 17128102148763401844727391012658070312041680139265
1.9608 abundancy: 544706177982549702958952749796737439494424115664705
1.9691 abundancy: 4667881618814760247691330223903618580123079973531611295745
1.9725 abundancy: 45908434000712176497468749961111887657369109162173794178305
1.9739 abundancy: 20671165880097771030991451401284178012993286123947910550749185
1.9785 abundancy: 52445816332184472814150357203402376197286862696891135470569985
1.9815 abundancy: 454384522121977914417851735056646516495735834430326771957444320441345
1.9879 abundancy: 21019218107216899012322554434327034417965188793122451203659352382093602305
1.9883 abundancy: 366116441889338617052913333853587858094413542349805277104215540158072855724810664705
1.9898 abundancy: 25865341477280238162991084220313606148895983102065954185447309420522519368872336059905
1.9900 abundancy: 125070125250137607038641725106269861293218779318441042656312739828852652401445783313665
2.0078 abundancy: 2059832906607460252767290568443059994787898033540634712711845135488141590979778401392385
2.0083 abundancy: 104839378567273535326333989187467825684502909839483372104871087869347999936961956982617345
2.0137 abundancy: 1447216195593005398648353707933247354204563393181444771890011664700344297440538854252794280387585
2.0173 abundancy: 921419623265562623096717808474853144451070951631410115607268753521016972220003379938879486594793539585
2.0189 abundancy: 429793242538590308946176026622307981303783195974490523228538398880954379493417904381408060355657465886697508072480699588892833140219672622657845944375981982322154769849506800478217665382681490585690183390030019118172116301058180060845169814785
2.0274 abundancy: 742738189777086442886204477984996833523559707217818002340574410192204739214228137592918025176732797705628101056762772300625218702414652520252414884396367396909893568725658367182245586873653595022942255311082392730595053341904897439853976520069754580387304854830626672105172017312013130155209988268739544525029187342401104963455482504129399525922179585
