#!/usr/bin/perl

# An interesting subset of Carmichael numbers, defined by Tomasz Ordowski.

# Numbers n such that:
#    LCM_{prime p|n} (p-1) = LCM_{p-1|n-1 p prime} (p-1).

# The sequence starts with:
#   5615659951, 36901698733, 55723044637, 776733036121, 2752403727511

# There are 191 terms below 2^64. (Amiram Eldar)

use 5.020;
use strict;
use warnings;

use Storable;
use ntheory qw(:all);
use Math::Prime::Util::GMP;
use experimental qw(signatures);

my $storable_file = "cache/factors-carmichael.storable";
my $carmichael    = retrieve($storable_file);

while (my ($n, $value) = each %$carmichael) {

    my $len = length($n);

    next if $len > 25;

    my @factors = split(' ', $value);

    # LCM_{prime p|n} (p-1)
    my $lambda = Math::Prime::Util::GMP::lcm(map { Math::Prime::Util::GMP::subint($_, 1) } @factors);

    # LCM_{p-1|n-1 p prime} (p-1)
    my $nm1_lambda = Math::Prime::Util::GMP::lcm(grep { is_prime(Math::Prime::Util::GMP::addint($_, 1)) }
                                                 Math::Prime::Util::GMP::divisors(Math::Prime::Util::GMP::subint($n, 1)));

    if ($lambda eq $nm1_lambda) {
        say $n;
    }
}

__END__

# Some terms > 2^64 (with possible gaps)

19114558109565017689
20230630853980919401
22141625199484567801
22215120344491755691
22529663924546241181
25386119280784743481
25924989688444386241
28978454676377746429
29867088371939187991
30318386850404810191
32769125516913288823
37021823365914760861
37556988590472702121
38828539513546918489
41554576879097551001
42413470588135422481
51962220848246948821
54394551778580574571
57418587477814985809
57497895903551319145
59330861971412406481
59662076701876801601
60067364589317116801
60578083587383438389
75400966971297147409
77536456230441680011
83614655738571164561
84184085494074532297
87022263331910146801
88173732755415387889
90237180744934029649
92280763606092325213
93710188449954875191
93822813689313686221
98859949021708246621
101102355896934458791
101835144237644778961
102680034251644994689
110048368052608365439
124294096524877689889
140201436081215626291
141695017911874541521
142574842639076416111
145783156417369160329
146792000154169233721
153449636363740310021
155633914345461092389
157779922846871952721
158469297776349010471
163527052666170975571
165182244289575678313
165211948988981005441
165307852383156082651
165787644061109524141
173577126731545530013
174957119182038132169
187477497057001979449
196013805446356947631
201154594187963653357
214487207780890812241
219565936897319453767
227572902700417949533
230717561879876065649
233733769174391833993
237320457131816425081
259038202064820034361
294248512379995452787
305405826402423635869
317258004364244519521
343877950351903537441
355408131002899184011
360854498797512771421
364166313110654741281
379558022672371804489
405063351294790406161
430971193522194567031
442367366339546395729
494679069280599402319
494949986416266994981
559135404710040474961
641318239930620561913
642211741876619976571
718308457223971179421
746129072941476519511
762644575625605975945
767272748413716200989
785407501652611738249
837121735015052277529
839280215259662067001
985250619948284436097
989369930301649944211
1016949840876026653411
1059181108364030805091
1258875850710225528421
1265957229487070069677
1302314329666924953841
1325589924256173751681
1329435468455356769221
1529862130905126596929
1530862167339815632489
1570171435228532142109
1576523869719035603041
1588829243493548989969
1600000532261708779369
1633113326229171133969
1671458997526110349921
1681811750271684111901
1696989748070244092581
1735566564665741858461
1838626348500129351241
1899960755503161704581
1923480124405389716797
1961994884203588873057
2183835958938374088421
2205786287570680941841
2262472456866637958821
2293690036807062832649
2298483391799253377449
2339397643613273890489
2371476375092489983471
2589090455517342749641
2591668500088979967661
2808470650354318152457
3013300917687634467601
3081844673549576115409
3148344571430612552041
3165824058073916222341
3168983629751877384529
3342213268155524462671
3345805871771633533481
3534911947538298976321
3555378721845655590511
3562058425268000396761
3577387006677427255789
3686971965170548246465
3752871022293657498541
3848978043129362829049
3984149141379488933911
3988073652213296857921
4102304147420376187081
4299359701758648773221
4376485735222725927139
4487467436479450960561
4587504217357161137671
4595968333053233266609
4644240647543842093351
4819502315462775624913
4837145878002158207731
4839227303245740494821
4906224372666967280281
4974013854559816732249
5043976022024820461221
5105247360431310431681
5135581881494231999041
5391425568428573669101
5425813882721552092561
5528838911336720160169
5666737496923856415601
5839454328187621332049
6440353562056332348001
6494793693552626601601
6747814678856214365569
6792610830904507077067
7091388274673938460401
7428429195920784072589
7680916106742821358241
8050800229412885260633
8362947354878468073889
8644068231671644772953
8765381577199070242057
8945409477317895726031
9108267615740966886109
9303969535735893479033
9431024985758715364351
9641036869192178077237
9740384587144023601771
9887385841850857996009
9903461500208308164469
10005033359513665564573
10714140474878018227393
10847829291910506376489
10975865664321153277849
11394144382121359540471
11636553501487506509857
12447609292180710829981
12511505454821915818369
12708478036613663876809
12908169680311942059421
13280066346899425227841
13384614743271950543641
14529230326331980069681
14583199020932853591841
14605230716479912545061
15435013256877071380321
16809386714941913503249
16987559528173462908709
17562513119768713154521
17624234282428480750297
17739299244826082150501
18447646795497420598945
19915618738580955734341
19993698573964039926001
20762987017143874008241
21277119219250588669711
21835042977323814225061
22902673711036927139569
23232781774850232839101
23534618448723802347691
24092528508798275096911
24111395761527811156321
24468586754102528078161
24702495767161308764821
24914380376839651491421
25358289831609120354511
25928468062652374515577
25929413411331739365181
25939873672197357573481
26214931079713940163571
26466841444869611268031
28145044904477224414591
28309426966506730187557
28358021449787008332889
30208293325168934122531
31870674231334668759133
31929585020858606069971
32310859772210842640971
32387604620650641740233
32797846069839321553531
32830267796242467075781
33131934610375046742871
34082376803078292562411
34821485853017489393609
35020347772951775636581
37031419254531657944717
37537206168574082685241
38557310749242585298291
38662282263810187144711
38746091536834964168611
38932082490303731534341
39767964063998539743529
40688027970847508087513
40745119960804146657031
40913926031980631204653
41331874786437146725801
41487048161578760076811
42060571027345749318631
42272395592144594125231
44088964893087828434731
45195865307817451465969
46168474161936321738091
46356346423828682227099
46505361882195477385201
49731637513659361567471
51789098291717687592331
52494166706624983806211
53168686298413854996781
55692571769024008641901
55754637690686490646021
55895351114852627423671
57401173905192900238501
58253604240547048888741
59183824434452143224793
59611080627973821120529
60776117751939122799991
61269560576761382627041
61380585724653747471745
61380656246291430223261
63261199394242044642289
65295380210340153470131
65408472800420439469081
67540911190630708046737
70368428625708224984545
72551968682678568830821
73115004327235780275697
73241587618660343877331
73798340623379875918171
77542174236063390479701
77725063330017930216631
81454323598552119482341
86654086426101113304421
87237649555809177689191
90219562335886637901209
90302017841579288819449
90738498586554993467593
94025180203331711535991
94354660620512604056989
94690005678654603429811
94971682065929255693329
95120033126285154914641
95666431532782944977821
96249684256810718111449
99793068033002028503569
100683488743154826027877
101586264198509357752741
101600479022257803913921
101994314267223824072999
104212341055526049480601
109552330773679382734681
112468162014987836790217
113638976865636084580081
114437669374103731477081
114825651585698387602531
114882775094266181645689
115332452895356713672849
118541871336716175686491
122182686744211952365861
122677214843546320665529
123472084215556462294891
126462243901248204544237
126545163122046318293431
126705236469082747013611
126869928040128508342831
128382301575623625991471
128588990470508035322341
133186770891069578012689
137175210114330367001791
137864597235471737027977
143314691156678531331631
149926436997847803732169
150657977792710200120031
150960826688323330414297
151240037948918257805281
151379556208764346079009
154358427384054616934971
154726977098478869431129
156488903881238840904649
158716532248340071260319
163425684807534420857071
167225246738458556189401
168230339838547214464129
168876889493551498341541
175481813238912745308349
176003020999237929542249
176168861272640869542991
176801386760387380893691
180043963116689087879971
182044446250015530941521
184936038129365814053857
186477551867295020487511
189671274703731162844441
199155273614392328395621
199349746483453306345861
216378599195774352821509
224391890281110182713711
226729623951196418542969
227955580061565933705353
228507507947024557682941
232729041905292004037221
238946074369112919221221
239934487328167509703141
243634366281140218679731
244374918656945896283941
246329305044289842409021
247995199827732107328421
251393740843592947297111
254379568512404699666401
254507739213355368578521
255731855966390571793201
256815772903273658379931
259111684038639288358041
259731827964818563815721
260535290580097305861401
264270310489018369965641
264858648294622679807833
269929481328086648912489
270589673244355618149433
272854726789710328203697
280462399400170791885871
281280617711224150467457
286194712297710920096821
297306077324382129504511
300563745467157614684341
303813357701994411892261
306727915685186718973801
326422223600764715933041
326454636194318621086787
333860754743894436145471
334204958496410253614821
334303927022217442564441
345248027880794086625641
347086497366864117834649
351605685031377197451769
352154210246377231856131
355651851598544443386601
357870078768755233413289
375469781769023069076211
387886249008278422809571
389357862029518200996421
392441819147788758945769
392918675674591645210129
398744156342879554962061
409570963577863899489829
421994974704850406665621
421996077683346061012769
428154417715705888811713
438972256475240331888631
473031822435345180777871
477963810893156284019977
479451012916231387277401
486632571576832332229411
490357518696418042745479
491435082215350664397481
493450625156725222490071
494061624830503737701857
505158322008781234661689
508461189246865163393731
510107778561397912937449
522539693188505486069521
530125859524391855310565
533326270875599782524511
547073287081199287903951
549513912628993845600211
552367133588120038709671
561679585474003235191471
565583658370718355234649
573563235193836890608801
574108288497140217153661
590414191031212693981741
632957776411691380972687
633025331258098387740247
648956611793611849416481
655504011943974264383761
656443547701998788204281
657443626312388983057729
663413204443586569486963
669976294340059358302769
682354436741314800112831
697409854324139420656111
697422666652130516818969
706585777387327515924709
709345493202499863361411
716189413704003618517741
716665380967559711731249
734514232246936724135521
741422974097555902503121
753824917096307958138001
758104076541140192886289
764324701537704517257211
795550931978116785376861
796235199302282885656561
799814101050042617751745
800381871691656536035129
811155234025659520905697
824699861777286634532233
834232064244097207926601
848962255701244704083929
897871372754806063117153
904602777314907480467551
915350416320680262363409
931476417754025273414101
934904523074076443474953
939004880001293525524273
985592546204140123306237
999048331633216117136689
1009138839681919921542961
1027135486176439800588121
1034829292678489682489077
1036110308295380961016753
1053288418801407415411681
1063508550299512987409569
1065932929937153098384019
1069777930942620115449169
1071145805102619304350181
1089975536626047281424721
1134901444831580042925841
1143293621164842033231001
1210223201287863481865929
1234840586498484856911817
1243690749179311281501961
1254586602546506868662731
1263592537651026212323681
1284460126852302108313921
1319392607168691362020561
1327957170494962798645961
1329444055050201913243681
1338403217375534024266201
1356720276965959265172049
1371550102403745695689747
1398609741661600546796881
1403401910902300214674561
1437155701685976783095017
1505420534826688570285201
1540974743324631930024865
1546741001053466688084541
1569640789648218948044273
1577803641460814035493233
1581818680704993733274581
1586985686369119534521329
1612871134521140272453921
1673014724491470108100321
1689220457520826180178539
1715882319747001640538289
1740138575611178005632289
1743774169315131411007801
1779361853879058925666177
1838503115024132379851993
1845822805278697907735449
1866200764308777750682081
2014292701327522661369089
2042930096379363948898141
2095115628332521584304381
2102544149661056571397921
2122420882120667036471569
2123911167064221978733909
2132039521916154164236129
2134973534772693029945801
2161631471438375891922809
2253689840194134796481281
2316709828674359682758809
2348046728050368107654081
2351508586951463365760041
2402171190468103829454991
2415936923534554514155981
2460075469947608304066787
2493227914952508388655029
2508305211632036318485969
2579075263555432743219661
2726578072407715498363921
2755933932456454847186359
2792284531141596942331621
2809614658669167318047731
2810572255549866091984921
2865990215866263152588741
2965293872653947633717881
3036366475680175953474553
3133250881765080487168969
3140537411311805719367461
3263411311860852289911121
3277139926169280294656809
3311866545858114986525753
3361867042568127025602241
3394112973927008634816481
3430682716979855636000065
3437122869054069960862261
3463949288392918957618711
3554329932590694827042251
3613223351128913697103993
3627883895834555391019621
3645739152492847324644061
3649281344290542261627241
3791262765887833534742161
3831628229959335658118881
3840495833460444309496369
3867099694937038179964009
3872124097490020756685941
3888987119737629545986681
3924064932471215221829041
3934158467304333608593849
3936334987481082386732849
3942109473011722541494333
4001128349065156310661361
4035007089125516137480561
4045773320100108496441033
4047995352652897693404529
4055359692099381592384921
4094008459783718633752897
4099042970144194575414241
4178414826004699886993101
4194846663285728430923489
4208259346578982118323489
4304117015029306459394641
4330591353040060504402261
4500666208719755874581041
4522526765452366690886413
4547889261312960920801077
4623936836455660984954891
4692450444187051706802703
4710270686346052252888651
4773876755258613307541761
4899382703987026708588117
4909993061122401551352673
4936939810998721791191641
4987674862601814947696689
5007165032963778744596821
5007221588958357811253221
5135226058785300560569001
5135394942045782963521741
5207508484999841520329401
5217026346505647607362181
5270444540510450021561521
5459050912759911400903561
5473142199034603403923621
5565774153249028331555041
5566599720873617308452169
5717331977435875777296721
5784013298897956213132681
5815241282464604479956133
5875021332707106567249181
5877293518909957352041369
6004025284867857068891131
6071903437189246693879921
6137272870567848141704881
6318474148670862217034257
6382614053460244728604609
6407148076704502027343521
6415965939865461060164761
6454414256465086452718481
6491550598273255804049881
6502583803553584063108289
6526722695485811351262689
6532930363738572788845861
6608341263060359444203177
6619715619859232916746887
6777682187373022133410567
6946444947550966226412601
7382938045441198588705171
7436324697211488266508043
7557939595192614986232449
7622303570380979366330305
7651159141258554529543849
7710766545677365896158833
7853049224356949179873193
8026822183032223520438017
8311936277617490023031857
8804146571497861705558543
8876215003117923172460729
8930900843638250840347093
8950566403178433577448929
9062250127820186635104481
9275312318351995711338121
9429060090884740612185337
9505908468633251172847609
9592665763748581521066889
9625292819079605387806801
9777516701620004506074361
10532918767038566957598889
10824341437997399279376811
11851242499988150145582271
12324938331473999227371961
12484746410556221814242881
13536731550856201226032129
14608404726809335827652291
14618971309548988189615321
15226734511171152814286401
16707707500282357324646161
17092383869666618383711501
17832662048844351720057041
18105356786087012586671773
19754039101878246506178049
20582960998218777899955631
21478341315732565041637801
21945341523533542085282137
22074519378342179688465061
23174626698749801411623201
24179524376378497716250921
28680066373137300787251409
28923666517050582065698121
29650290226467280439478289
30932166700212251284583749
31797680021061094635495841
32380444626451854725799721
33131071932568321533225161
35296264952731504206175561
35872163897459012514624961
35995862417138992463642821
37583523553610285110906027
40219612854984537564216313
46726032500452768346975617
46764300652341154249595761
49603073759249403170394001
51487570849113203101865053
65615989305799434984546961
69164759372123060189404561
76835691420219630020565697
98385450236736866318300617
131124850594002036656916401
139427531429225540378870161
146351055605776213848593401
160395951458323384458754369
170403083492686304698956337
180251735523018502890048217
187302762755532146079902821
197762122813515155689406041
202639838781019827476197441
214989536967636095217773761
243491218605916507311429481
248466129407545932508310449
403644027821455794253615021
430220764820292743140741769
434194666237216729750445821
440459628466867005534615361
523336888478947860620825689
550173394814572330336567411
551495386051881490077738811
551605928620978742710323241
563233520674220606853454921
599433384166864529074714801
618965372260105252087804021
695065118868697738848418981
779845932567596283989698151
812681357549913121851514657
820970913246751535876748493
887924937510744866559892627
903936980445688909196502457
966952276700123040649296481
1412491570475171138902230823
1419455462562907988125409041
1463980793868404716911119359
1706229743348063574040814521
1976610212547882426629643097
1983664707095841152504551201
2207676524998272986592848633
2547062557114471523020016761
2547490750730367760918580401
2637570901120133798518374649
2902374946579038530827087081
3081046866831121121407368721
3404655104708716628681770321
3757409331808531538617956019
3863342771017557045817700053
4314027889960432020905416201
4447962376800520263030161911
5189082616976667637945752631
5443164683088111562600017113
6751393408975420481755016161
8050961121054622732647037801
8067337543679966971189817311
9212918408710197184873656865
10631223461241942007914952561
11911558013758103537605552921
12366813903721443931501207801
12422301880170199207271244241
16168159917010412758713858049
16405153793279037495660047041
16490602539062940022862690641
17276127863608645057826871649
23126106420887964122275099093
25727177935344670827545527921
28676249535761511456928281841
32147572936582296563089231639
35334403028753799003805066723
38743253674607329348298058193
47065075327605964703282177761
47338209805666772001127899781
48301728217278473610466925489
55717283163035244683619594169
55738394993438102407355988445
68448268025538859062864202129
71964812984011702196114269001
83701538468470999341846474349
83789683378453273588356927433
115133642119138011370027515031
115583415885998336331782094289
127730546655449482468067773969
137047118388343330101492709801
138001572885540763262194144801
147055436540899372259582974129
149949104461812495638587396649
162644965752286130794215887521
167160687778416562854407673289
220201201729087194638657481361
251355485281074228712166877289
305753359281886886067769051621
340635937342598746015510873351
407432124845119234661550206401
490005807250992187540603198933
578959656271798761602939468581
641364291495855191181210206761
672543143281419652719732445201
816275414671463058956003338921
824210894943032707862790889201
829236235460366907211445543291
906247697507566010955290392201
921700165922123585194285704961
960816449665685341517386285873
1058069376989189030569686172561
1133541838087696741536175790161
1197496921261442164690554308341
1389051488086967879047999162369
1527175136655598431139056606817
1574277211991655084237315052321
1645407564506985009418909557841
1740701396314106689565364085201
2060331074473891751938773826921
2583392109591835967120521539097
3351388988994008676780143926801
4621245965720986499480225233621
5118804177805147901960473762801
5271222682189523956137705530039
8178727575128265468650438448481
10108588951209104805834258119401
11694153887939230304405333374693
16045668135621291475164657320641
18439369804308361267153476345259
19512695887533338397664607518249
26079830334105297664728701931121
31053931794965957145352045666897
32465508249664947532012632712081
34684498552665286074214417812301
41295612050664360934585634055061
58013182436223835712574300255481
64427047702049932656839749391761
90685880691669556429853486801641
93541891604578241090078814528241
120855351659858930210705032381321
122371476172714542628841701074097
143899044084041899524168303901981
146884256116396384632103398769489
150182902816963952782988584232533
177577543756292334135309483288841
196205797979646916785459433621021
215044295430222267580692903234817
253498162448615085063782619823729
254133197317737698122235280762241
355088902271770497663766754532721
406366208352657383950052526864601
439824350259228144698001452538661
469456154866319303553835339623781
496506602821188308759447427087013
710949646709753565055009265835121
795607031856660765045114569150701
1159148180774015326300451940567505
1303935372842789620709617366740133
1825742013502595458124791783679653
1942956661710850322997864485095813
4117036519933639464701849147295391
6741471587264811281287558911072853
9001835140212206674207683100770241
11827921114368039415018912268362453
23296554004171962845069027329658761
43118712348246138305327503700054161
104956451401988264667265687368913633
215986823783275088831204687276368249
253406011725193431291992727971604529
357232294680125188232867511969563221
491066766775836209301209567930433121
703453309278263370525478981113921493
953462679486044934853085680263921121
1148684176303850895336648886795278049
1552974442056224627002394948422036501
2824303014713287714672361455723282321
19669497977732254837569378995837891041
26988404787484570686994017175717290421
67749723270243605961208458415643261761
68093269767015242048885765594065058581
87588251235332360498915523181796801713
206291024218666953550710021834437986801
616481755312170633176653964161244211241
5229169734778800096154482140435381699821
6727657243948042354122005070996461582053
10766347691735976598106160112237867456321
22769985603288559665252886989467212286281
26815746055696553502557223767663224844737
38078580214374399404828283858189287999281
43734176403021901897017433043077300553041
302019317198734742854606944588574536569281
2194361013751071698764012356873512205015601
2284050194390860946003863024988610235501081
2800719199391802254033999942753919735361561
2884136427673355920171205787621529642620841
53643019761073440298782841824878623240833601
79011873219448469230306780827574814534318161
110700446267605619127548211603770469204564451
855113354405724169684857711304294766006430481
8453499590833264760103669195707283587678060305
33617762930294910939154037829795657390769776721
76194853896462434252328433229045615765351962801
379733491470755914832842983714378627088372568881
1528111333073039654482059215397925629889486896721
2077509358707167449208463919433933715717608307457
74042551755745134229849948981137066326497479882001
