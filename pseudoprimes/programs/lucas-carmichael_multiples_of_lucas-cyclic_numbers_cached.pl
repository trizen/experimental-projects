#!/usr/bin/perl

# a(n) = least Lucas-Carmichael number which is divisible by b(n), where {b(n)} (A255602) is the list of all numbers which could be a divisor of a Lucas-Carmichael number.
# https://oeis.org/A253598

# See also:
#   https://oeis.org/A255602

# Couldn't find values for the following multiples: 471 489 579 633 831 849 939 993 997

use 5.020;
use strict;
use warnings;
use experimental qw(signatures);

use Storable;
use Math::GMPz;
use ntheory qw(:all);
use Math::Prime::Util::GMP;
use experimental qw(signatures);

my $lucas_carmichael_file = "cache/factors-lucas-carmichael.storable";
my $lucas_carmichael      = retrieve($lucas_carmichael_file);

my @lucas_cyclic = grep {
    my $n = $_;
    vecall { gcd($n, $_ + 1) == 1 } factor($n)
} grep { is_square_free($_) } grep { $_ > 469 } grep { $_ % 2 == 1 } (1 .. 1000);
my $lucas_cyclic_lcm = Math::Prime::Util::GMP::lcm(@lucas_cyclic);

my $z = Math::GMPz::Rmpz_init();

my %table;

while (my ($n, $value) = each %$lucas_carmichael) {

    if (Math::Prime::Util::GMP::gcd($n, $lucas_cyclic_lcm) eq '1') {
        next;
    }

    Math::GMPz::Rmpz_set_str($z, $n, 10);

    foreach my $c (@lucas_cyclic) {
        if (Math::GMPz::Rmpz_divisible_ui_p($z, $c)) {
            if (not exists $table{$c} or Math::GMPz::Rmpz_cmp($z, $table{$c}) < 0) {
                $table{$c} = Math::GMPz::Rmpz_init_set($z);
            }
        }
    }
}

foreach my $key (sort { $a <=> $b } keys %table) {
    printf("%4d: %25s\n", $key, $table{$key});
}

my @unknown;

foreach my $c (@lucas_cyclic) {
    if (not exists $table{$c}) {
        push @unknown, $c;
    }
}

if (@unknown) {
    say "\nCouldn't find values for the following multiples: @unknown";
}

__END__

# Upper-bounds greater than 2^64:

 479:      18464541461764325759
 481:      18497556719577959855
 485:      21656120098172329055
 487:      19198941779167564799
 491:      25892110205229497999
 493:      18649701014141655359
 497:      18641854304002696319
 499:      19127069830361251499
 503:      18500957172670863743
 505:      19788094580867249615
 509:      19587737049013064399
 511:      18485546076556729919
 515:      22630570368177569615
 517:      18569138064485039999
 521:      20188217632968408815
 523:     271235111465126364479
 527:      18925333974597123359
 533:      18654485473319481071
 535:      25424438943526160615
 541:     201250498202063069759
 543:      91350019044877683999
 547:      22768543955521689839
 551:      18484403740144664399
 553:      19323796232959882559
 557:      22416379210313566847
 559:      22931179185633619823
 563:      19252278122010234587
 565:      18451872489960275135
 569:      19152629413926543359
 571:      19074204712750447259
 577:      27811057191450237119
 583:      18674266835663335259
 587:      18654485473319481071
 589:      19118903741968161599
 593:      19429976706386625719
 595:      19368275302185129215
 597:      41369683493898381999
 599:      18699554037470619599
 601:      21707603139995503919
 607:      18451872489960275135
 611:      19165340354725998719
 613: 2421784006992846228697137179
 617:      27561249087372014399
 619:      19212811549828959599
 623:      18484403740144664399
 629:      21516451830860416199
 631:     116875645666210976831
 635:      19130273353252970495
 641:      30462645479552070719
 643:      26953895458922028519
 647:      18548043558942796415
 649:      18545781638931460199
 651:   63778497110926861521279
 653:     150261671571410900879
 655:      20678743841735072015
 659:      18877339588759872659
 661:     160005119573799657119
 667:      18484403740144664399
 669:     739131774277687224447
 671:      23278602079480513535
 673: 58884994757542163066980200421679
 677:      25653534435272652719
 683:      19258281639593384543
 685:      22730332660728835295
 687:   63778497110926861521279
 689:      18699554037470619599
 691:      68420188581926483999
 697:      18649701014141655359
 701:      18674266835663335259
 707:      19417826395001048399
 709:      70093300401246698279
 713:      18617311094780111615
 715:      18802108791086790455
 719:      18526311126117426239
 721:      20814779687987887679
 723:   58389819955617904045599
 727:      22247424389266723919
 731:      19090237056002481599
 733:   37625734181363628585599
 737:      18484403740144664399
 739:      18485546076556729919
 741:    2521527626785294946559
 743:      19740538161915582479
 749:      18579920950666393199
 751:      22209000740436421679
 755:      18497556719577959855
 757:     539511928170558281999
 761:     432597306192650449343
 763:      19393015898651280599
 767:      18464541461764325759
 769:      19074204712750447259
 773:      19166027587290978659
 777:   93777929207438828995839
 779:      18816038745121290959
 781:      18816038745121290959
 785:   11987614260786429449855
 787:      35092924030851503879
 791:      18451872489960275135
 793:      19740538161915582479
 797:      18497556719577959855
 799:      18649701014141655359
 803:      22263934607719940399
 805:      18451872489960275135
 809:      18617376588757430399
 811:      20670731955621500759
 813:     739131774277687224447
 815:      56821788523913906735
 817:      19377336244930250399
 821:      66283227234704581559
 823:     321513157287189573695
 827:      18570275041567263695
 829:      23004813256697082359
 835:      18617311094780111615
 839:      18464541461764325759
 851:      21516451830860416199
 853:      48985624815390597599
 857:      19393015898651280599
 859:      19166027587290978659
 863:      18548043558942796415
 865:      20188217632968408815
 869:      18649701014141655359
 871:      22931179185633619823
 877:     126613350755705133899
 881:      19231020075233163959
 883:      24482796761004148943
 887:      18485546076556729919
 889:      27535701430399835519
 893:      18569138064485039999
 899:      18464541461764325759
 901:      18674266835663335259
 903:     392858754024500895999
 905:      19448350474642381655
 907:     503352516332851795439
 911:      18451872489960275135
 913:      18545781638931460199
 917:      19731364929275791967
 919:      23151524420653412399
 921:      26953895458922028519
 923:      18816038745121290959
 929:      19212811549828959599
 935:      18548043558942796415
 937:      18684925217203343615
 941:      29033197636772758799
 943:      18617311094780111615
 947:      45275439346681517039
 949:      23090822274928657535
 953:      20107565369028885887
 955:      18684925217203343615
 959:      23151524420653412399
 965:     956310205736829375935
 967:      20637129623622084143
 971:      18548043558942796415
 977:      28590537641915747999
 979:      18484403740144664399
 983:      33325906509921971759
 985:      22714495050033315935
 989:      19377336244930250399
 991:      48945043866468671999

Couldn't find values for the following multiples: 471 489 579 633 831 849 939 993 997
